bootstrap: docker
from: ubuntu:24.04

%post
    set -e
    export DEBIAN_FRONTEND=noninteractive

    echo "deb http://archive.ubuntu.com/ubuntu noble universe" >> /etc/apt/sources.list
    apt-get update

    apt-get install -y \
        python3-dev python3-pip python3-full swig git \
        ca-certificates curl \
        libgl1 libglib2.0-0

    python3 -m venv /venv
    . /venv/bin/activate

    pip install --upgrade pip setuptools wheel

    pip install "hockey @ git+https://github.com/martius-lab/hockey-env.git"

    # IMPORTANT: Pascal (sm_61) needs an older CUDA build of PyTorch.
    # Force cu118 wheels:
    pip install --no-cache-dir torch torchvision torchaudio \
      --index-url https://download.pytorch.org/whl/cu118

    # the rest
    pip install --no-cache-dir \
        matplotlib numpy box2d-py pygame gymnasium tensorboardx \
        notebook jupyterlab ipympl wandb

    apt-get clean
    rm -rf /var/lib/apt/lists/*
    pip cache purge

%runscript
    . /venv/bin/activate
    exec "$@"
